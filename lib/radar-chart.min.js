var RadarChart={defaultConfig:{containerClass:"radar-chart",w:600,h:600,factor:.95,factorLegend:1,levels:3,maxValue:0,radians:2*Math.PI,color:d3.scale.category10(),axisLine:true,axisText:true,circles:true,radius:5,axisJoin:function(e,t){return e.className||t},transitionDuration:300},chart:function(){function t(t){t.each(function(t){function u(t,n,r,i){r=typeof r!=="undefined"?r:1;return n*(1-r*i(t*e.radians/s))}function a(e,t,n){return u(e,t,n,Math.sin)}function f(e,t,n){return u(e,t,n,Math.cos)}var n=d3.select(this);t=t.map(function(e){if(e instanceof Array){e={axes:e}}return e});var r=Math.max(e.maxValue,d3.max(t,function(e){return d3.max(e.axes,function(e){return e.value})}));var i=t[0].axes.map(function(e,t){return e.axis});var s=i.length;var o=e.factor*Math.min(e.w/2,e.h/2);n.classed(e.containerClass,1);var l=d3.range(0,e.levels).map(function(t){return o*((t+1)/e.levels)});var c=n.selectAll("g.level-group").data(l);c.enter().append("g");c.exit().remove();c.attr("class",function(e,t){return"level-group level-group-"+t});var h=c.selectAll(".level").data(function(e){return d3.range(0,s).map(function(){return e})});h.enter().append("line");h.exit().remove();h.attr("class","level").attr("x1",function(e,t){return a(t,e)}).attr("y1",function(e,t){return f(t,e)}).attr("x2",function(e,t){return a(t+1,e)}).attr("y2",function(e,t){return f(t+1,e)}).attr("transform",function(t){return"translate("+(e.w/2-t)+", "+(e.h/2-t)+")"});if(e.axisLine||e.axisText){var p=n.selectAll(".axis").data(i);var d=p.enter().append("g");if(e.axisLine){d.append("line")}if(e.axisText){d.append("text")}p.exit().remove();p.attr("class","axis");if(e.axisLine){p.select("line").attr("x1",e.w/2).attr("y1",e.h/2).attr("x2",function(t,n){return a(n,e.w/2,e.factor)}).attr("y2",function(t,n){return f(n,e.h/2,e.factor)})}if(e.axisText){p.select("text").attr("class",function(e,t){var n=a(t,.5);return"legend "+(n<.4?"left":n>.6?"right":"middle")}).attr("dy",function(e,t){var n=f(t,.5);return n<.1?"1em":n>.9?"0":"0.5em"}).text(function(e){return e}).attr("x",function(t,n){return a(n,e.w/2,e.factorLegend)}).attr("y",function(t,n){return f(n,e.h/2,e.factorLegend)})}}t.forEach(function(t){t.axes.forEach(function(t,n){t.x=a(n,e.w/2,parseFloat(Math.max(t.value,0))/r*e.factor);t.y=f(n,e.h/2,parseFloat(Math.max(t.value,0))/r*e.factor)})});var v=n.selectAll(".area").data(t,e.axisJoin);v.enter().append("polygon").classed({area:1,"d3-enter":1}).on("mouseover",function(e){n.classed("focus",1);d3.select(this).classed("focused",1)}).on("mouseout",function(){n.classed("focus",0);d3.select(this).classed("focused",0)});v.exit().classed("d3-exit",1).transition().duration(e.transitionDuration).remove();v.each(function(e,t){var n={"d3-exit":0};n["radar-chart-serie"+t]=1;if(e.className){n[e.className]=1}d3.select(this).classed(n)}).style("stroke",function(t,n){return e.color(n)}).style("fill",function(t,n){return e.color(n)}).transition().duration(e.transitionDuration).attr("points",function(e){return e.axes.map(function(e){return[e.x,e.y].join(",")}).join(" ")}).each("start",function(){d3.select(this).classed("d3-enter",0)});if(e.circles&&e.radius){var m=n.selectAll(".tooltip").data([1]);m.enter().append("text").attr("class","tooltip");var g=n.selectAll("g.circle-group").data(t,e.axisJoin);g.enter().append("g").classed({"circle-group":1,"d3-enter":1});g.exit().classed("d3-exit",1).transition().duration(e.transitionDuration).remove();g.each(function(e){var t={"d3-exit":0};if(e.className){t[e.className]=1}d3.select(this).classed(t)}).transition().duration(e.transitionDuration).each("start",function(){d3.select(this).classed("d3-enter",0)});var y=g.selectAll(".circle").data(function(e,t){return e.axes.map(function(e){return[e,t]})});y.enter().append("circle").classed({circle:1,"d3-enter":1}).on("mouseover",function(e){m.attr("x",e[0].x-10).attr("y",e[0].y-5).text(e[0].value).classed("visible",1);n.classed("focus",1);n.select(".area.radar-chart-serie"+e[1]).classed("focused",1)}).on("mouseout",function(e){m.classed("visible",0);n.classed("focus",0);n.select(".area.radar-chart-serie"+e[1]).classed("focused",0)});y.exit().classed("d3-exit",1).transition().duration(e.transitionDuration).remove();y.each(function(e){var t={"d3-exit":0};t["radar-chart-serie"+e[1]]=1;d3.select(this).classed(t)}).style("fill",function(t){return e.color(t[1])}).transition().duration(e.transitionDuration).attr("r",e.radius).attr("cx",function(e){return e[0].x}).attr("cy",function(e){return e[0].y}).each("start",function(){d3.select(this).classed("d3-enter",0)});var b=m.node();b.parentNode.appendChild(b)}})}var e=Object.create(RadarChart.defaultConfig);t.config=function(n){if(!arguments.length){return e}if(arguments.length>1){e[arguments[0]]=arguments[1]}else{d3.entries(n||{}).forEach(function(t){e[t.key]=t.value})}return t};return t},draw:function(e,t,n){var r=RadarChart.chart().config(n);var i=r.config();d3.select(e).select("svg").remove();d3.select(e).append("svg").attr("width",i.w).attr("height",i.h).datum(t).call(r)}}